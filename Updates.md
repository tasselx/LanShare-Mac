# LanShare 更新日志

## 2025-11-03 - 限速传输功能

### 新增功能

#### ⚡ 限速传输
- 添加全局速度限制功能
- 可开启/关闭限速开关
- 支持自定义传输速度设置（KB/s）

#### 🎛️ 速度预设
- 512 KB/s - 慢速传输
- 1 MB/s (1024 KB/s) - 标准速度
- 5 MB/s (5120 KB/s) - 快速传输
- 10 MB/s (10240 KB/s) - 高速传输

#### 🎨 用户界面改进
- 在主界面顶部添加限速设置区域
- 限速开关和速度设置控件
- 实时显示当前限速状态
- 快速预设按钮，方便切换常用速度
- 支持手动输入自定义速度值

### 技术实现

#### NetworkManager.swift
- 添加 `isSpeedLimitEnabled` 属性控制限速开关
- 添加 `speedLimitKBps` 属性存储限速值（默认1024 KB/s）
- 重构 `downloadFile` 方法，支持限速和非限速两种模式
- 新增 `sendFileWithSpeedLimit` 方法实现限速传输
- 新增 `sendChunks` 方法实现分块发送和延迟控制

#### ContentView.swift
- 新增 `SpeedLimitSettingsView` 组件
- 新增 `SpeedPresetButton` 组件
- 在主界面集成限速设置区域
- 实时同步和显示限速状态

#### 文档更新
- 更新 README.md，添加限速功能说明
- 更新 FEATURES.md，详细描述限速功能特性
- 在开发计划中标记限速功能为已完成

### 工作原理

限速传输通过以下机制实现：

1. **分块传输**：将文件数据分成多个数据块
2. **速度控制**：每个数据块大小 = 限速值（KB/s）× 1024 字节
3. **定时发送**：每秒发送一个数据块
4. **精确控制**：使用 DispatchQueue.asyncAfter 控制发送间隔

示例：
- 设置限速为 1024 KB/s（1 MB/s）
- 每个数据块大小 = 1024 × 1024 = 1,048,576 字节
- 每秒发送一个 1MB 的数据块
- 实际传输速度约为 1 MB/s

### 使用方法

1. 启动应用后，在顶部状态栏下方可以看到"限速传输"开关
2. 打开开关启用限速功能
3. 使用快速预设按钮选择常用速度，或手动输入自定义速度
4. 实时显示区会显示当前限速设置
5. 所有文件下载都将按设定速度进行限速传输

### 优势

- **带宽管理**：避免文件传输占用所有带宽，影响其他网络应用
- **网络友好**：在网络环境较差时，可降低传输速度以保证稳定性
- **灵活控制**：支持快速预设和自定义速度，满足不同场景需求
- **实时调整**：可在传输过程中随时调整速度设置

### 后续计划

- [ ] 单文件独立限速（为每个文件单独设置速度）
- [ ] 限速统计（显示实际传输速度和传输进度）
- [ ] 动态限速（根据网络状况自动调整）
- [ ] 限速日志（记录传输速度历史）

